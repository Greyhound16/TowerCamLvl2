<!DOCTYPE html>
<html>
<head>
  <title>Fire Tower MVP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<h2>Fire Tower MVP</h2>

<video id="video" autoplay playsinline width="100%"></video>

<button onclick="enableSensors()">ENABLE SENSORS</button>
<button onclick="confirm()">CONFIRM POINTING</button>

<script>
let heading = null;

async function enableSensors() {
  // CAMERA
  const stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: "environment" }
  });
  document.getElementById("video").srcObject = stream;

  // ORIENTATION (iPhone + Android)
  if (typeof DeviceOrientationEvent?.requestPermission === "function") {
    const permission = await DeviceOrientationEvent.requestPermission();
    if (permission === "granted") {
      window.addEventListener("deviceorientation", handleOrientation);
    }
  } else {
    window.addEventListener("deviceorientationabsolute", handleOrientation);
  }
}

function handleOrientation(e) {
  if (e.webkitCompassHeading !== undefined) {
    heading = e.webkitCompassHeading; // iOS
  } else if (e.alpha !== null) {
    heading = e.alpha; // Android
  }
}

function confirm() {
  if (heading === null) {
    alert("Compass not ready");
    return;
  }

  navigator.geolocation.getCurrentPosition(pos => {
    fetch("https://YOUR_BACKEND_URL/report", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({
        lat: pos.coords.latitude,
        lon: pos.coords.longitude,
        bearing: heading,
        time: Date.now()
      })
    });
    alert("Pointing confirmed");
  });
}
</script>

</body>
</html>
