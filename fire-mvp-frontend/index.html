<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
video { width:100vw; height:100vh; object-fit:cover; }
#cross { position:fixed; top:50%; left:50%; width:40px; height:40px;
transform:translate(-50%,-50%);
}
#cross:before,#cross:after {
content:""; position:absolute; background:red;
}
#cross:before { width:100%; height:2px; top:50%; }
#cross:after { height:100%; width:2px; left:50%; }
#panel { position:fixed; bottom:10px; left:50%; transform:translateX(-50%);
background:rgba(0,0,0,.6); color:white; padding:10px; border-radius:10px; }
</style>
</head>

<body>

<video id="cam" autoplay playsinline></video>
<div id="cross"></div>

<div id="panel">
  <div id="heading">Heading: --</div>
  <button onclick="confirm()">CONFIRM</button>
</div>

<script>
let heading = 0;
const tower_id = prompt("Tower ID (A/B/C):");

navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})
.then(s => cam.srcObject = s);

window.addEventListener("deviceorientation", e => {
  if (e.webkitCompassHeading !== undefined)
    heading = e.webkitCompassHeading;
  else if (e.alpha !== null)
    heading = e.alpha;

  document.getElementById("heading").innerText =
    "Heading: " + heading.toFixed(1);
});

function confirm(){
  navigator.geolocation.getCurrentPosition(p=>{
    fetch("https://fire-mvp-backend.onrender.com/report",{
      method:"POST",
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        tower_id,
        lat:p.coords.latitude,
        lon:p.coords.longitude,
        bearing:heading
      })
    });
    alert("Sent");
  });
}
</script>

</body>
</html>
