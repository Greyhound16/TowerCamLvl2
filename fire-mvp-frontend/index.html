<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Fire Tower MVP</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  background: black;
  color: white;
  font-family: Arial, sans-serif;
}

video {
  width: 100vw;
  height: 100vh;
  object-fit: cover;
}

/* Crosshairs */
.cross-v, .cross-h {
  position: fixed;
  background: rgba(255,0,0,0.8);
  z-index: 10;
}
.cross-v {
  width: 2px;
  height: 100vh;
  left: 50%;
  top: 0;
}
.cross-h {
  height: 2px;
  width: 100vw;
  top: 50%;
  left: 0;
}

#panel {
  position: fixed;
  bottom: 10px;
  width: 100%;
  text-align: center;
  z-index: 20;
}

button, input {
  font-size: 18px;
  padding: 6px;
  margin: 4px;
}
</style>
</head>

<body>

<video id="video" autoplay playsinline></video>
<div class="cross-v"></div>
<div class="cross-h"></div>

<div id="panel">
  <input id="tower" placeholder="Tower ID (A/B/C)">
  <div id="status">Waiting for GPS…</div>
  <button onclick="send()">CONFIRM</button>
</div>

<script>
const BACKEND = "https://fire-mvp-backend.onrender.com";

let lat = null, lon = null;
let bearing = 0; // Forward-facing relative bearing

// CAMERA
navigator.mediaDevices.getUserMedia({
  video: { facingMode: "environment" }
}).then(stream => video.srcObject = stream);

// LOCATION
navigator.geolocation.watchPosition(
  p => {
    lat = p.coords.latitude;
    lon = p.coords.longitude;
    status.innerText = "GPS ready – aim at smoke and tap CONFIRM";
  },
  e => {
    alert("Location error: " + e.message);
    status.innerText = "GPS error";
  },
  { enableHighAccuracy: true }
);

// SEND DATA TO BACKEND
function send(){
  if (lat === null || lon === null) {
    alert("GPS not ready");
    return;
  }

  fetch(BACKEND + "/report", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      tower: tower.value || "X",
      lat: lat,
      lon: lon,
      bearing: bearing // always forward-facing
    })
  });

  status.innerText = "Sent ✓";
}
</script>

</body>
</html>
