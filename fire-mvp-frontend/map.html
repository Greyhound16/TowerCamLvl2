<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<style>#map{height:100vh}</style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
const BACKEND = "https://fire-mvp-backend.onrender.com";

const map = L.map("map").setView([14,121],13);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

let lines = [];

function draw(lat,lon,b){
  const r=b*Math.PI/180;
  const dLat=Math.cos(r)*0.02;
  const dLon=Math.sin(r)*0.02;
  return [[lat,lon],[lat+dLat,lon+dLon]];
}

async function update(){
  lines.forEach(l=>map.removeLayer(l));
  lines=[];

  const data = await (await fetch(BACKEND+"/reports")).json();
  Object.values(data).forEach(t=>{
    lines.push(L.polyline(draw(t.lat,t.lon,t.bearing),
      {color:"red"}).addTo(map));
  });
  setTimeout(update,1000);
}
update();
</script>
</body>
</html>
